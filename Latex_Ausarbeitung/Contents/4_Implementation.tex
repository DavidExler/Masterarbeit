% !TeX root = ../Thesis.tex

\chapter{Implementation} \label{ch:Implementation}
If appropriate and not done in the previous chapter, describe the implementation of your method.


\section{Überblick}
Im nachfolgenden Kapitel wird die Implementierung aller relevanten Methoden erklärt. Hierbei steht die praktische Anwendung dieser Methoden in Form von Nutzerschnittstellen oder als Entwicklerskript auf ausgewiesener Hardware im Vordergrund.

\section{Segmentierungsnetze}
\begin{itemize}
    \item Wie sind die Netze je eingebunden?
    \item Welche Hardware?
    \item Welche Vor-/Nachverarbeitung?
\end{itemize}

\section{Labeling App}
Um den Klassifikator zu trainieren werden \ac{gt} zu einigen Zieldaten mithilfe der Labeling App erstellt. 
Als Frontend dieser App dient eine dash Anwendung die eine einfache html \ac{gui} bereitstellt. 
Das Backend ist mit Python erstellt und die gesammelten Daten werden als JSON gespeichert.
Hierzu ist ein Docker mit Zugriff auf das lokale Dateiensystem versehen und über Kubernetes betrieben.
\begin{figure}
    \centering
    \includegraphics[width=0.98\linewidth]{Figures/GUI_Labeling_App.png}
    \caption{Die Grafik zeigt die \ac{gui} der Labeling App. In der Mitte wird die Zelle angezeigt, die gelabelt werden soll und links sind Bedienelemente zu sehen. Unter der dargestellten Zelle befindet sich ein Schieberegler, der die Navigation entlang der Z-Achse ermöglicht. Über die Bedienelemente kann der/die Nutzer*In zwischen Bildern und Zellen umschalten, die Klasse der Zelle bestimmen, den gezeigten Ausschnitt mit prozentualen Schwellenwerten normalisieren und und die Fenstergröße ändern.}
    \label{fig:Labeling_App}
\end{figure}
Fig. \ref{fig:Labeling_App} zeigt die \ac{gui} der Labeling App. Zentral zu sehen ist ein Fenster, das einen 2D Schnitt der ausgewählten Zelle anzeigt. Darauf ist ein roter Kasten gezeichnet, der die ausgewählte Zelle umrandet, sodass Zellen, die dicht aneinander liegen unterschieden werden können. 
Mit dem Schieberegler unter dem Fenster kann ausgewählt werden, welche er Schichten in denen die Zelle anwesend ist, gezeigt werden soll. Über dem Fenster ist der Index der aktuell dargestellten Zelle und des Bilds angegeben.
Links neben dem Fenster befinden sich Bedienelemente mit den folgenden Funktionen:
\begin{itemize}
    \item \textit{Vorheriges Bild}: Vorheriges Bild auswählen.
    \item \textit{Nächstes Bild}: Nächstes Bild auswählen.
    \item \textit{Vorherige Zelle}: Vorherige Zelle auswählen.
    \item \textit{Nächste Zelle}: Näxchste Zelle auswählen.
    \item \textit{Class X}: Bestimmte Klasse als \ac{gt} der ausgewählten Zelle definieren.
    \item \textit{Nächster undefinierter}: Nächste Zelle ohne eingetragene \ac{gt} auswählen.
    \item \textit{Speichern}: Speichert manuell die festgelegten \ac{gt}s ab. Die Labeling App speichert außerdem eigenständig periodisch.
    \item \textit{Untere \% Abschneiden}: Unteren prozentualen Schwellwert wählen, der bei der nächsten Normalisierung angewandt werden soll.
    \item \textit{Obere \% Abschneiden}: Oberen prozentualen Schwellwert wählen, der bei der nächsten Normalisierung angewandt werden soll.
    \item \textit{Normalisieren}: Normalisierung lokal auf den Ausschnitt der aktuell ausgewählten Zelle anwenden. Intensitätswerte die im beziehungsweise über dem Perzentil der eingetragenen Schwellwerten werden hierbei zusammengefasst.
    \item \textit{Zoom In}: Verkleinert den anzuzeigenden Ausschnitt.    
    \item \textit{Zoom Out}: Vergrößert den anzuzeigenden Ausschnitt.    
\end{itemize}

Für das Backend sind einige Python Skripte direkt im Docker mounted. 
Da die wichtigste Anforderung der Anwendung die nutzerfreundliche Bedienung ist, sind alle Berechnungen, die während der Nutzung der Labeling App ausgeführt werden, darauf ausgelegt die Rechnenzeit zu minimieren. 
Hierzu werden alle Bilder und Masken bei der Initialisierung der App in den cache geladen.
Des Weiteren ist eine Klasse angelegt, die separat noch das aktuell ausgewählte Bild und die ausgewählte Zelle speichert. 
Erst wenn eine Änderung der Auswahl ausgeführt wird, wird eine neue Zelle oder ein neues gesamtes Bild geladen und selbst dann lediglich aus dem cache. 

